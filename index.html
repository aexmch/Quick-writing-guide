<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing Workshop - AI è‹±æ–‡å¯«ä½œæ¨‚åœ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .serif { font-family: 'Noto Serif TC', serif; }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes pop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.05); border-radius: 10px; }
        .bg-bubbly { background-image: radial-gradient(circle at 2px 2px, rgba(0,0,0,0.05) 1px, transparent 0); background-size: 24px 24px; }
        .btn-bounce:hover { transform: translateY(-2px) scale(1.02); }
        .btn-bounce:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-white min-h-screen transition-colors duration-1000 bg-bubbly">
    <div id="app" class="max-w-7xl mx-auto p-4 md:p-8">
        <!-- å…§å®¹å°‡ç”± JavaScript å‹•æ…‹æ³¨å…¥ -->
    </div>

    <script>
        // --- å¯«ä½œæ¶æ§‹è³‡æ–™åº« (åŒ…å« 33 å€‹é¡Œç›®èˆ‡æ¯æ­¥é©Ÿ 3 å€‹é›™èªä¾‹å¥) ---
        const WRITING_TEMPLATES = {
            chart: {
                title: "åœ–è¡¨åˆ†æ", subtitle: "Chart Analysis", theme: "cyan", color: "cyan-500",
                icon: "bar-chart-3", hasTopics: true,
                topics: [
                    { id: "time", title: "After School Time", icon: "clock", desc: "åˆ†æé«˜ä¸­ç”Ÿèª²å¾Œæ™‚é–“åˆ†é…ï¼Œè¨è«–å­¸æ¥­èˆ‡ä¼‘é–’çš„å¹³è¡¡ã€‚", type: "chart", items: [{label: "Studying", value: 45, color: "bg-cyan-400"}, {label: "Gaming", value: 30, color: "bg-pink-400"}, {label: "Sports", value: 15, color: "bg-yellow-400"}, {label: "Others", value: 10, color: "bg-slate-300"}] },
                    { id: "stress", title: "Sources of Stress", icon: "frown", desc: "èª¿æŸ¥é¡¯ç¤ºé’å°‘å¹´å£“åŠ›çš„ä¸»è¦ä¾†æºã€‚", type: "chart", items: [{label: "Academic", value: 55, color: "bg-rose-400"}, {label: "Peer", value: 20, color: "bg-indigo-400"}, {label: "Family", value: 15, color: "bg-orange-400"}, {label: "Future", value: 10, color: "bg-teal-400"}] },
                    { id: "career", title: "Future Career", icon: "briefcase", desc: "å­¸ç”Ÿç•¢æ¥­å¾Œæœ€åš®å¾€çš„ç”¢æ¥­åˆ†å¸ƒæƒ…æ³ã€‚", type: "chart", items: [{label: "Tech/AI", value: 40, color: "bg-blue-500"}, {label: "Arts", value: 25, color: "bg-purple-400"}, {label: "Business", value: 20, color: "bg-emerald-400"}, {label: "Education", value: 15, color: "bg-amber-400"}] }
                ],
                steps: [
                    { 
                        id: "hook", label: "Hook å¼•è¨€", patterns: ["In recent years...", "Nowadays..."], words: ["crucial", "essential"], tip: "å¸å¼•è®€è€…æ³¨æ„è©²æ•¸æ“šä¸»é¡Œã€‚",
                        examples: [
                            { en: "In the era of information, data regarding student habits has become increasingly important.", tw: "åœ¨è³‡è¨Šæ™‚ä»£ï¼Œæœ‰é—œå­¸ç”Ÿç¿’æ…£çš„æ•¸æ“šè®Šå¾—æ—¥ç›Šé‡è¦ã€‚" },
                            { en: "With the rapid development of society, how teenagers spend their time is worth exploring.", tw: "éš¨è‘—ç¤¾æœƒçš„å¿«é€Ÿç™¼å±•ï¼Œé’å°‘å¹´å¦‚ä½•åˆ†é…æ™‚é–“å€¼å¾—æ¢è¨ã€‚" },
                            { en: "Statistics often reveal hidden truths about our daily habits and lifestyle choices.", tw: "çµ±è¨ˆæ•¸æ“šé€šå¸¸æœƒæ­ç¤ºé—œæ–¼æˆ‘å€‘æ—¥å¸¸ç¿’æ…£èˆ‡ç”Ÿæ´»æ–¹å¼é¸æ“‡çš„éš±è—çœŸç›¸ã€‚" }
                        ]
                    },
                    { 
                        id: "intro", label: "Intro ç°¡ä»‹", patterns: ["The chart illustrates...", "The graph shows..."], words: ["illustrates", "depicts"], tip: "ä½¿ç”¨å¼•å°å¥å‹ç°¡ä»‹åœ–è¡¨å…§å®¹ã€‚",
                        examples: [
                            { en: "The chart illustrates the various ways high school students spend their time after school.", tw: "é€™å¼µåœ–è¡¨èªªæ˜äº†é«˜ä¸­ç”Ÿåœ¨èª²å¾Œåˆ†é…æ™‚é–“çš„å„ç¨®æ–¹å¼ã€‚" },
                            { en: "As is shown in the graph, the distribution of student activities varies significantly.", tw: "å¦‚åœ–æ‰€ç¤ºï¼Œå­¸ç”Ÿå„é …æ´»å‹•çš„åˆ†å¸ƒæƒ…å½¢æœ‰é¡¯è‘—ä¸åŒã€‚" },
                            { en: "According to the visual data provided, several key categories define teenagers' lives.", tw: "æ ¹æ“šæä¾›çš„è¦–è¦ºæ•¸æ“šï¼Œå¹¾å€‹é—œéµé¡åˆ¥å®šç¾©äº†é’å°‘å¹´çš„æ—¥å¸¸ç”Ÿæ´»ã€‚" }
                        ]
                    },
                    { 
                        id: "trend", label: "Trend è¶¨å‹¢", patterns: ["Overall, it is clear that...", "What stands out is..."], words: ["dominant", "noteworthy"], tip: "æ‰¾å‡ºæ¯”ä¾‹æœ€å¤§èˆ‡æœ€å°çš„é …ç›®ã€‚",
                        examples: [
                            { en: "Overall, it is clear that studying accounts for the largest share of student time.", tw: "æ•´é«”è€Œè¨€ï¼Œå¾ˆæ˜é¡¯åœ°ã€Œè®€æ›¸ã€ä½”äº†å­¸ç”Ÿæ™‚é–“çš„æœ€å¤§ä»½é¡ã€‚" },
                            { en: "What stands out most is that academic pursuits dominate the daily routine.", tw: "æœ€é¡¯è‘—çš„ä¸€é»æ˜¯ï¼Œå­¸æ¥­è¿½æ±‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä½”æ“šä¸»å°åœ°ä½ã€‚" },
                            { en: "The most significant trend is the gap between education and exercise.", tw: "æœ€é¡¯è‘—çš„è¶¨å‹¢æ˜¯æ•™è‚²æ´»å‹•èˆ‡é«”è‚²é‹å‹•ä¹‹é–“çš„å·®è·ã€‚" }
                        ]
                    },
                    { 
                        id: "details", label: "Details æ•¸æ“š", patterns: ["...accounts for X%", "compared with"], words: ["approximately", "significant"], tip: "æ¯”è¼ƒä¸åŒæ•¸æ“šä¹‹é–“çš„å·®è·ã€‚",
                        examples: [
                            { en: "Specifically, studying takes up 45%, which is much more than sports at only 15%.", tw: "å…·é«”ä¾†èªªï¼Œè®€æ›¸ä½”äº† 45%ï¼Œé é«˜æ–¼åƒ…ä½” 15% çš„é‹å‹•ã€‚" },
                            { en: "Gaming accounts for 30%, followed by sports and other minor activities.", tw: "éŠæˆ²ä½”äº† 30%ï¼Œå…¶æ¬¡æ˜¯é‹å‹•å’Œå…¶ä»–æ¬¡è¦æ´»å‹•ã€‚" },
                            { en: "Compared with social media usage, physical activities occupy a much smaller percentage.", tw: "èˆ‡ç¤¾ç¾¤åª’é«”ä½¿ç”¨ç›¸æ¯”ï¼Œé«”è‚²æ´»å‹•æ‰€ä½”çš„æ¯”ä¾‹è¦å°å¾—å¤šã€‚" }
                        ]
                    },
                    { 
                        id: "implication", label: "Meaning å•Ÿç¤º", patterns: ["This suggests that...", "The data indicates..."], words: ["implies", "consequently"], tip: "ç¸½çµæ•¸æ“šåæ˜ å‡ºçš„æ„ç¾©ã€‚",
                        examples: [
                            { en: "This suggests that students are under heavy pressure and lack enough rest.", tw: "é€™é¡¯ç¤ºå­¸ç”Ÿæ‰¿å—è‘—æ²‰é‡çš„å£“åŠ›ï¼Œä¸”ç¼ºä¹è¶³å¤ çš„ä¼‘æ¯ã€‚" },
                            { en: "The data indicates that a more balanced lifestyle should be encouraged.", tw: "æ•¸æ“šè¡¨æ˜æ‡‰è©²é¼“å‹µé’å°‘å¹´æ¡å–æ›´å¹³è¡¡çš„ç”Ÿæ´»æ–¹å¼ã€‚" },
                            { en: "Consequently, parents should pay more attention to students' mental health.", tw: "å› æ­¤ï¼Œå®¶é•·æ‡‰è©²æ›´åŠ é—œæ³¨å­¸ç”Ÿçš„å¿ƒç†å¥åº·ã€‚" }
                        ]
                    }
                ]
            },
            letter: {
                title: "ç§äººæ›¸ä¿¡", subtitle: "Personal Letter", theme: "pink", color: "pink-500",
                icon: "heart", hasTopics: true,
                topics: [
                    { id: "sorry", title: "Apology to a Friend", icon: "heart-handshake", desc: "é“æ­‰ä¸¦å›æ†¶ç¾å¥½æ™‚å…‰ã€‚", type: "text" },
                    { id: "advice", title: "Advice to a Junior", icon: "graduation-cap", desc: "å»ºè­°å¦‚ä½•å¹³è¡¡ç¤¾åœ˜èˆ‡èª²æ¥­ã€‚", type: "text" },
                    { id: "thanks", title: "Thank-you Note", icon: "gift", desc: "å¯«ä¿¡çµ¦å½±éŸ¿ä½ æœ€æ·±çš„è€å¸«ã€‚", type: "text" }
                ],
                steps: [
                    { id: "greeting", label: "Greeting å•å€™", patterns: ["Dearest [Name],", "Hey [Name],"], words: ["Dearest", "Warmly"], tip: "ä½¿ç”¨æº«é¦¨çš„ç¨±å‘¼ã€‚", examples: [{ en: "Dearest Jamie,", tw: "è¦ªæ„›çš„ Jamieï¼Œ" }, { en: "Hey there, my old friend,", tw: "å—¨ï¼Œæˆ‘çš„è€æœ‹å‹ï¼Œ" }, { en: "My dear Jamie,", tw: "æˆ‘è¦ªæ„›çš„ Jamieï¼Œ" }] },
                    { id: "purpose", label: "Opening é–‹é ­", patterns: ["I've been thinking about...", "I'm writing to clear the air."], words: ["reflecting", "heart"], tip: "å¦èª åœ°é–‹å•Ÿè©±é¡Œã€‚", examples: [{ en: "I have been thinking a lot about our argument lately, and I feel quite bad.", tw: "æˆ‘æœ€è¿‘ä¸€ç›´åœ¨æƒ³æˆ‘å€‘åµæ¶çš„äº‹ï¼Œæˆ‘è¦ºå¾—å¾ˆéæ„ä¸å»ã€‚" }, { en: "I am writing this letter because I really want to clear the air between us.", tw: "æˆ‘å¯«é€™å°ä¿¡æ˜¯å› ç‚ºæˆ‘çœŸçš„å¾ˆæƒ³åŒ–è§£æˆ‘å€‘ä¹‹é–“çš„èª¤æœƒã€‚" }, { en: "It has been several days since we last talked, and I truly miss our friendship.", tw: "è‡ªå¾æˆ‘å€‘ä¸Šæ¬¡èªªè©±å·²ç¶“éäº†å¥½å¹¾å¤©ï¼Œæˆ‘çœŸçš„å¾ˆæ‡·å¿µæˆ‘å€‘çš„å‹èª¼ã€‚" }] },
                    { id: "details", label: "Apology é“æ­‰", patterns: ["I sincerely apologize for...", "I cherish our friendship."], words: ["regret", "cherish"], tip: "çœŸèª é“æ­‰ä¸¦è§£é‡‹åŸå› ã€‚", examples: [{ en: "I sincerely apologize for my impulsive words; I was just under stress.", tw: "æˆ‘èª æ‘¯åœ°ç‚ºæˆ‘çš„è¡å‹•è¨€è¾­é“æ­‰ï¼Œæˆ‘ç•¶æ™‚åªæ˜¯å£“åŠ›å¤ªå¤§äº†ã€‚" }, { en: "I cherish our friendship more than anything and regret the misunderstanding.", tw: "æˆ‘æ¯”ä»»ä½•äº‹ç‰©éƒ½çè¦–æˆ‘å€‘çš„å‹èª¼ï¼Œä¸¦å°é€™æ¬¡èª¤æœƒæ„Ÿåˆ°éºæ†¾ã€‚" }, { en: "I didn't mean to hurt you, and I hope you can understand it was a mistake.", tw: "æˆ‘ä¸¦ä¸æ˜¯æ•…æ„è¦å‚·å®³ä½ ï¼Œå¸Œæœ›ä½ èƒ½ç†è§£é‚£æ˜¯ä¸€å€‹éŒ¯èª¤ã€‚" }] },
                    { id: "expectation", label: "Hope æœŸè¨±", patterns: ["I hope we can...", "Let's grab a coffee."], words: ["reconnect", "forgive"], tip: "æå‡ºå…·é«”çš„ä¿®è£œå»ºè­°ã€‚", examples: [{ en: "I hope we can move past this and be best friends again like before.", tw: "å¸Œæœ›æˆ‘å€‘èƒ½å¿˜æ‰é€™ä»¶äº‹ï¼Œåƒä»¥å‰ä¸€æ¨£å†æ¬¡æˆç‚ºæœ€å¥½çš„æœ‹å‹ã€‚" }, { en: "Let's grab a coffee this weekend and talk things over in person.", tw: "æˆ‘å€‘é€™é€±æœ«å»å–æ¯å’–å•¡ï¼Œç•¶é¢æŠŠäº‹æƒ…èŠé–‹å§ã€‚" }, { en: "I really hope you can forgive me and give our friendship another chance.", tw: "æˆ‘çœŸå¿ƒå¸Œæœ›ä½ èƒ½åŸè«’æˆ‘ï¼Œå†çµ¦æˆ‘å€‘çš„å‹èª¼ä¸€æ¬¡æ©Ÿæœƒã€‚" }] },
                    { id: "closing", label: "Closing çµå°¾", patterns: ["Best,", "Yours always,"], words: ["Truly", "Love"], tip: "é¸æ“‡æº«æš–çš„çµå°¾èªã€‚", examples: [{ en: "Best wishes,", tw: "è‡´ä¸Šæœ€å¥½çš„ç¥é¡˜ï¼Œ" }, { en: "Your friend always,", tw: "ä½ æ°¸é çš„æœ‹å‹ï¼Œ" }, { en: "Love,", tw: "æ„›ä½ çš„ï¼Œ" }] }
                ]
            },
            opinion: {
                title: "æ„è¦‹è¡¨é”", subtitle: "Opinion Writing", theme: "indigo", color: "indigo-500",
                icon: "message-square", hasTopics: true,
                topics: [
                    { id: "ai", title: "AI in Classroom", icon: "cpu", desc: "èª²å ‚ä¸­ä½¿ç”¨ AI å·¥å…·çš„çœ‹æ³•ï¼Ÿ", pro: "æ•ˆç‡æå‡", con: "å‰Šå¼±æ€è€ƒ" },
                    { id: "ban", title: "Smartphone Ban", icon: "smartphone-off", desc: "å­¸æ ¡æ‡‰å…¨é¢ç¦æ­¢æ‰‹æ©Ÿå—ï¼Ÿ", pro: "å°ˆæ³¨å­¸ç¿’", con: "è¯çµ¡ä¸ä¾¿" },
                    { id: "uniform", title: "School Uniforms", icon: "shirt", desc: "é«˜ä¸­ç”Ÿæ‡‰è©²ç¹¼çºŒç©¿åˆ¶æœä¸Šå­¸å—ï¼Ÿ", pro: "ç¯€çœæ™‚é–“", con: "å£“æŠ‘é¢¨æ ¼" }
                ],
                steps: [
                    { id: "hook", label: "Hook å¼•å°", patterns: ["...is a hot topic lately.", "...sparked heated debates."], words: ["controversial", "debate"], tip: "æè¿°è­°é¡Œçš„é‡è¦æ€§ã€‚", examples: [{ en: "In recent years, the use of AI tools in education has sparked heated debates.", tw: "è¿‘å¹´ä¾†ï¼Œåœ¨æ•™è‚²ä¸­ä½¿ç”¨ AI å·¥å…·å¼•èµ·äº†æ¿€çƒˆçš„çˆ­è«–ã€‚" }, { en: "Whether schools should ban smartphones is a hot topic that affects everyone.", tw: "å­¸æ ¡æ˜¯å¦æ‡‰ç¦æ­¢æ‰‹æ©Ÿæ˜¯ä¸€å€‹å½±éŸ¿æ¯å€‹äººçš„ç†±é–€è©±é¡Œã€‚" }, { en: "The question of school uniforms has been a frequent source of discussion.", tw: "æ ¡æœå•é¡Œå¹¾åå¹´ä¾†ä¸€ç›´æ˜¯é »ç¹è¨è«–çš„ä¾†æºã€‚" }] },
                    { id: "thesis", label: "Topic ç«‹å ´", patterns: ["From my perspective,", "I firmly believe that..."], words: ["standpoint", "convinced"], tip: "æ¸…æ¥šè¡¨é”ä½ çš„æ ¸å¿ƒç«‹å ´ã€‚", examples: [{ en: "From my perspective, I strongly agree that AI can be a learning partner.", tw: "å¾æˆ‘çš„è§€é»ä¾†çœ‹ï¼Œæˆ‘éå¸¸åŒæ„ AI å¯ä»¥æˆç‚ºå­¸ç¿’å¤¥ä¼´ã€‚" }, { en: "I firmly believe that banning smartphones is beneficial for concentration.", tw: "æˆ‘å …ä¿¡ç¦æ­¢æ‰‹æ©Ÿå°å­¸ç”Ÿçš„å°ˆæ³¨åŠ›æ˜¯æœ‰ç›Šçš„ã€‚" }, { en: "In my view, wearing uniforms creates a sense of equality on campus.", tw: "åœ¨æˆ‘çœ‹ä¾†ï¼Œç©¿åˆ¶æœåœ¨æ ¡åœ’ä¸­å‰µé€ äº†ä¸€ç¨®å¹³ç­‰æ„Ÿã€‚" }] },
                    { id: "reason1", label: "Reason 1 ç†ç”±", patterns: ["Firstly,", "To begin with,"], words: ["primary", "essential"], tip: "çµ¦å‡ºé¦–è¦æ”¯æŒç†ç”±ã€‚", examples: [{ en: "Firstly, AI tools can provide personalized guidance for students.", tw: "é¦–å…ˆï¼ŒAI å·¥å…·å¯ä»¥ç‚ºå­¸ç”Ÿæä¾›å€‹äººåŒ–çš„æŒ‡å°ã€‚" }, { en: "To begin with, a phone-free environment encourages real-life interaction.", tw: "é¦–å…ˆï¼Œä¸€å€‹ç„¡æ‰‹æ©Ÿçš„ç’°å¢ƒèƒ½é¼“å‹µç¾å¯¦ç”Ÿæ´»ä¸­çš„äº’å‹•ã€‚" }, { en: "The primary reason is that uniforms save students a lot of time.", tw: "ä¸»è¦åŸå› æ˜¯åˆ¶æœç‚ºå­¸ç”Ÿç¯€çœäº†å¤§é‡çš„æ™‚é–“ã€‚" }] },
                    { id: "reason2", label: "Reason 2 è£œå……", patterns: ["Furthermore,", "In addition,"], words: ["moreover", "important"], tip: "è£œå……å¦ä¸€å€‹æ”¯æŒé»ã€‚", examples: [{ en: "Furthermore, using technology prepares students for their future careers.", tw: "æ­¤å¤–ï¼Œä½¿ç”¨ç§‘æŠ€èƒ½ç‚ºå­¸ç”Ÿçš„æœªä¾†è·æ¶¯åšå¥½æº–å‚™ã€‚" }, { en: "In addition, it prevents online distractions during class hours.", tw: "æ­¤å¤–ï¼Œå®ƒèƒ½é˜²æ­¢ä¸Šèª²æœŸé–“çš„ç¶²è·¯åˆ†å¿ƒã€‚" }, { en: "Moreover, uniforms reduce the pressure of fashion competition.", tw: "å†è€…ï¼Œåˆ¶æœæ¸›è¼•äº†é’å°‘å¹´ä¹‹é–“æ™‚å°šç«¶çˆ­çš„å£“åŠ›ã€‚" }] },
                    { id: "concession", label: "Concession è®“æ­¥", patterns: ["Admittedly, ...", "While some argue..."], words: ["nevertheless", "outweigh"], tip: "å…ˆæ‰¿èªå°æ–¹è§€é»å†åé¥‹ã€‚", examples: [{ en: "Admittedly, some worry about integrity, but proper guidance can solve this.", tw: "èª ç„¶ï¼Œæœ‰äº›äººæ“”æ†‚èª ä¿¡å•é¡Œï¼Œä½†é©ç•¶çš„å¼•å°å¯ä»¥è§£æ±ºé€™å€‹å•é¡Œã€‚" }, { en: "While some argue it limits freedom, the benefits far outweigh the costs.", tw: "é›–ç„¶æœ‰äººèªç‚ºå®ƒé™åˆ¶äº†è‡ªç”±ï¼Œä½†å…¶ç›Šè™•é å¤§æ–¼ä»£åƒ¹ã€‚" }, { en: "Nevertheless, personal style can still be expressed in other ways.", tw: "å„˜ç®¡å¦‚æ­¤ï¼Œå€‹äººé¢¨æ ¼ä»ç„¶å¯ä»¥é€éå…¶ä»–æ–¹å¼å±•ç¾ã€‚" }] },
                    { id: "conclusion", label: "Conclusion ç¸½çµ", patterns: ["In conclusion,", "To sum up,"], words: ["ultimately", "thought"], tip: "é‡ç”³ç«‹å ´ä¸¦çµ¦äºˆå»ºè­°ã€‚", examples: [{ en: "In conclusion, we should embrace AI as a tool rather than a threat.", tw: "ç¸½ä¹‹ï¼Œæˆ‘å€‘æ‡‰è©²å°‡ AI æ“æŠ±ç‚ºå·¥å…·ï¼Œè€Œéè¦–ç‚ºå¨è„…ã€‚" }, { en: "To sum up, a balanced policy on smartphones is essential for school life.", tw: "ç¸½çµä¾†èªªï¼Œå¹³è¡¡çš„æ‰‹æ©Ÿæ”¿ç­–å°æ ¡åœ’ç”Ÿæ´»è‡³é—œé‡è¦ã€‚" }, { en: "Ultimately, uniforms help maintain a focused learning environment.", tw: "æœ€çµ‚ï¼Œåˆ¶æœæœ‰åŠ©æ–¼ç¶­æŒä¸€å€‹å°ˆæ³¨çš„å­¸ç¿’ç’°å¢ƒã€‚" }] }
                ]
            },
            narrative: {
                title: "æ•˜äº‹å¯«ä½œ", subtitle: "Story Telling", theme: "amber", color: "amber-500",
                icon: "camera", hasTopics: true,
                topics: [
                    { id: "lesson", title: "Unexpected Lesson", icon: "lightbulb", desc: "æè¿°ä¸€æ¬¡æ„å¤–å­¸åˆ°çš„ç¶“é©—ã€‚", type: "text" },
                    { id: "courage", title: "Moment of Courage", icon: "shield", desc: "é¼“èµ·å‹‡æ°£å¹«åŠ©ä»–äººçš„ç¬é–“ã€‚", type: "text" },
                    { id: "lost", title: "A Lost Item", icon: "search", desc: "æ‰¾å›çè²´ç‰©å“çš„å†’éšªã€‚", type: "text" }
                ],
                steps: [
                    { id: "setting", label: "Setting èƒŒæ™¯", patterns: ["It was a sunny day when...", "I had been looking forward to..."], words: ["excited", "anticipation"], tip: "äº¤ä»£æ™‚é–“åœ°é»å¿ƒæƒ…ã€‚", examples: [{ en: "It was a sunny Saturday morning when I set off for the hike.", tw: "é‚£æ˜¯ä¸€å€‹æ™´æœ—çš„é€±å…­æ—©æ™¨ï¼Œæˆ‘å‡ºç™¼å»å¥è¡Œã€‚" }, { en: "I had been looking forward to the school concert for months.", tw: "æˆ‘æœŸå¾…å­¸æ ¡éŸ³æ¨‚æœƒå·²ç¶“å¥½å¹¾å€‹æœˆäº†ã€‚" }, { en: "Everything started normally until a sudden change in the weather.", tw: "ä¸€åˆ‡é–‹å§‹å¾—å¾ˆæ­£å¸¸ï¼Œç›´åˆ°å¤©æ°£çªç„¶è½‰è®Šã€‚" }] },
                    { id: "conflict", label: "Conflict äº‹ä»¶", patterns: ["Unexpectedly, ...", "Things took a turn..."], words: ["suddenly", "shocked"], tip: "æè¿°æ„å¤–ç™¼ç”Ÿçš„ä¸€åˆ»ã€‚", examples: [{ en: "Unexpectedly, our bus broke down in the middle of a remote road.", tw: "å‡ºä¹æ„æ–™åœ°ï¼Œæˆ‘å€‘çš„å·´å£«åœ¨ååƒ»çš„è·¯ä¸­å¤®æ‹‹éŒ¨äº†ã€‚" }, { en: "Things took a turn for the worse when I realized my wallet was gone.", tw: "ç•¶æˆ‘ç™¼ç¾éŒ¢åŒ…ä¸è¦‹æ™‚ï¼Œæƒ…æ³æ€¥è½‰ç›´ä¸‹ã€‚" }, { en: "Suddenly, the power went out, and the stage was plunged into darkness.", tw: "çªç„¶é–“åœé›»äº†ï¼Œèˆå°é™·å…¥ä¸€ç‰‡é»‘æš—ã€‚" }] },
                    { id: "climax", label: "Climax é«˜æ½®", patterns: ["I found myself in a spot.", "At that moment, I realized..."], words: ["desperate", "struggle"], tip: "æè¿°æœ€ç·Šå¼µçš„è½‰æŠ˜ã€‚", examples: [{ en: "I found myself in a tough spot, standing alone in the rain.", tw: "æˆ‘ç™¼ç¾è‡ªå·±é™·å…¥å›°å¢ƒï¼Œç¨è‡ªç«™åœ¨é›¨ä¸­ã€‚" }, { en: "At that moment, I realized I had to stay calm to find my way back.", tw: "åœ¨é‚£ä¸€åˆ»ï¼Œæˆ‘æ„è­˜åˆ°æˆ‘å¿…é ˆä¿æŒå†·éœæ‰èƒ½æ‰¾åˆ°å›å»çš„è·¯ã€‚" }, { en: "Panic started to rise, but I knew I had to make a quick decision.", tw: "ææ…Œé–‹å§‹è”“å»¶ï¼Œä½†æˆ‘çŸ¥é“æˆ‘å¿…é ˆå¿«åšæ±ºå®šã€‚" }] },
                    { id: "resolution", label: "Ending çµå±€", patterns: ["Eventually, I decided to...", "With the help of..."], words: ["relief", "resolved"], tip: "æ•…äº‹æ˜¯å¦‚ä½•è½å¹•çš„ï¼Ÿ", examples: [{ en: "Eventually, a kind stranger offered me a ride back to the station.", tw: "æœ€å¾Œä¸€ä½å¥½å¿ƒçš„é™Œç”Ÿäººè¼‰æˆ‘å›åˆ°äº†è»Šç«™ã€‚" }, { en: "With the help of my friends, we managed to find the lost key.", tw: "åœ¨æœ‹å‹çš„å¹«åŠ©ä¸‹ï¼Œæˆ‘å€‘æˆåŠŸæ‰¾åˆ°äº†éºå¤±çš„é‘°åŒ™ã€‚" }, { en: "To my surprise, the audience cheered even louder after the fix.", tw: "ä»¤æˆ‘é©šè¨çš„æ˜¯ï¼Œä¿®ç†å¥½ä¹‹å¾Œè§€çœ¾çš„æ­¡å‘¼è²æ›´å¤§äº†ã€‚" }] },
                    { id: "theme", label: "Lesson å•Ÿç¤º", patterns: ["Looking back, I learned...", "This experience taught me..."], words: ["valuable", "insight"], tip: "å¸¶çµ¦ä½ çš„æˆé•·ã€‚", examples: [{ en: "Looking back, I learned that kindness can be found in unexpected places.", tw: "å›é¦–å¾€äº‹ï¼Œæˆ‘å­¸åˆ°äº†åœ¨ä¸ç¶“æ„çš„åœ°æ–¹ä¹Ÿèƒ½ç™¼ç¾å–„æ„ã€‚" }, { en: "This experience taught me the importance of staying calm under pressure.", tw: "é€™æ¬¡ç¶“æ­·æ•™å°äº†æˆ‘å£“åŠ›ä¸‹ä¿æŒå†·éœçš„é‡è¦æ€§ã€‚" }, { en: "I realized that sometimes, mistakes lead to the best memories.", tw: "æˆ‘æ„è­˜åˆ°æœ‰æ™‚å€™ï¼ŒéŒ¯èª¤æœƒå¸¶ä¾†æœ€ç¾å¥½çš„å›æ†¶ã€‚" }] }
                ]
            },
            problem: { title: "è§£æ±ºå•é¡Œ", subtitle: "Problem & Solution", theme: "orange", color: "orange-500", icon: "help-circle", hasTopics: true,
                topics: [
                    { id: "plastic", title: "Plastic Waste", icon: "trash-2", desc: "æ ¡åœ’å…§é¤å…·éé‡å•é¡ŒåŠå°ç­–ã€‚", type: "text" },
                    { id: "addict", title: "Internet Addiction", icon: "monitor-off", desc: "æ²‰è¿·ç¤¾ç¾¤åª’é«”çš„å½±éŸ¿åŠè§£æ±ºã€‚", type: "text" },
                    { id: "sleep", title: "Lack of Sleep", icon: "bed", desc: "ç¡çœ ä¸è¶³ç¾ç‹€åŠæ”¹å–„å»ºè­°ã€‚", type: "text" }
                ],
                steps: [
                    { id: "problem", label: "Problem å•é¡Œ", patterns: ["One major issue is...", "Recently, ... has become..."], words: ["concerning", "challenge"], tip: "æè¿°å…·é«”å›°é›£ã€‚", examples: [{ en: "One major issue we face today is the excessive use of plastic on campus.", tw: "æˆ‘å€‘ä»Šå¤©é¢è‡¨çš„ä¸€å€‹é‡å¤§å•é¡Œæ˜¯æ ¡åœ’å…§éåº¦ä½¿ç”¨å¡‘è† ã€‚" }, { en: "Recently, internet addiction has become a growing concern among teens.", tw: "æœ€è¿‘ï¼Œç¶²è·¯æˆç™®å·²æˆç‚ºé’å°‘å¹´ä¸­æ—¥ç›Šåš´é‡çš„æ“”æ†‚ã€‚" }, { en: "It is concerning that many students suffer from severe lack of sleep.", tw: "ä»¤äººæ“”æ†‚çš„æ˜¯ï¼Œè¨±å¤šå­¸ç”Ÿæ‚£æœ‰åš´é‡çš„ç¡çœ ä¸è¶³ã€‚" }] },
                    { id: "causes", label: "Causes åŸå› ", patterns: ["The main reason is...", "This problem arises from..."], words: ["root cause", "factor"], tip: "åˆ†æå•é¡Œèµ·å› ã€‚", examples: [{ en: "The main reason behind this is the convenience of disposable products.", tw: "èƒŒå¾Œçš„ä¸»è¦åŸå› æ˜¯å…æ´—ç”¢å“çš„ä¾¿åˆ©æ€§ã€‚" }, { en: "This problem arises from the need for social validation on digital apps.", tw: "é€™å€‹å•é¡Œæºæ–¼åœ¨æ•¸ä½æ‡‰ç”¨ç¨‹å¼ä¸Šå°‹æ±‚ç¤¾äº¤èªå¯çš„éœ€æ±‚ã€‚" }, { en: "A key contributing factor is the heavy workload and late-night studying.", tw: "ä¸€å€‹é—œéµçš„ä¿ƒæˆå› ç´ æ˜¯æ²‰é‡çš„èª²æ¥­è² æ“”å’Œç†¬å¤œè®€æ›¸ã€‚" }] },
                    { id: "sol1", label: "Sol 1 å°ç­–ä¸€", patterns: ["To address this, we could...", "The first step is to..."], words: ["effective", "measure"], tip: "ç¬¬ä¸€å€‹è§£æ±ºæ–¹æ¡ˆã€‚", examples: [{ en: "To address this, schools could implement a strict policy on plastic bags.", tw: "ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œå­¸æ ¡å¯ä»¥å°å¡‘è† è¢‹å¯¦æ–½åš´æ ¼çš„æ”¿ç­–ã€‚" }, { en: "The first step is to set a daily time limit for using mobile applications.", tw: "ç¬¬ä¸€æ­¥æ˜¯è¨­å®šæ¯æ—¥ä½¿ç”¨è¡Œå‹•æ‡‰ç”¨ç¨‹å¼çš„æ™‚é–“é™åˆ¶ã€‚" }, { en: "One effective measure is to adjust the school starting time to later.", tw: "ä¸€å€‹æœ‰æ•ˆçš„æªæ–½æ˜¯å°‡ä¸Šå­¸æ™‚é–“èª¿æ™šã€‚" }] },
                    { id: "sol2", label: "Sol 2 å°ç­–äºŒ", patterns: ["In addition, ...", "Another solution is..."], words: ["furthermore", "alternative"], tip: "è£œå……å»ºè­°ã€‚", examples: [{ en: "In addition, providing reusable utensils in the cafeteria is practical.", tw: "æ­¤å¤–ï¼Œåœ¨é¤å»³æä¾›å¯é‡è¤‡ä½¿ç”¨çš„é¤å…·æ˜¯å¾ˆå¯¦ç”¨çš„åšæ³•ã€‚" }, { en: "Furthermore, outdoor activities should be organized to distract students.", tw: "å†è€…ï¼Œæ‡‰è©²çµ„ç¹”æˆ¶å¤–æ´»å‹•ä¾†è½‰ç§»å­¸ç”Ÿçš„æ³¨æ„åŠ›ã€‚" }, { en: "Another potential solution is to provide time-management workshops.", tw: "å¦ä¸€å€‹æ½›åœ¨çš„è§£æ±ºæ–¹æ¡ˆæ˜¯æä¾›æ™‚é–“ç®¡ç†å·¥ä½œåŠã€‚" }] },
                    { id: "outlook", label: "Outlook å±•æœ›", patterns: ["By doing so, we can...", "I believe with efforts..."], words: ["promising", "sustainable"], tip: "æœªä¾†å±•æœ›ã€‚", examples: [{ en: "By doing so, we can build a more sustainable and eco-friendly school.", tw: "é€éé€™æ¨£åšï¼Œæˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€å€‹æ›´æ°¸çºŒä¸”ç’°ä¿çš„æ ¡åœ’ã€‚" }, { en: "I believe that with these efforts, students can regain control.", tw: "æˆ‘ç›¸ä¿¡é€éé€™äº›åŠªåŠ›ï¼Œå­¸ç”Ÿå¯ä»¥é‡æ–°æŒæ§è‡ªå·±çš„ç”Ÿæ´»ã€‚" }, { en: "Ultimately, these changes will lead to improved health for all.", tw: "æœ€çµ‚ï¼Œé€™äº›æ”¹è®Šå°‡æœƒæ”¹å–„æ‰€æœ‰äººçš„å¥åº·ã€‚" }] }
                ]
            },
            compare: { title: "å°æ¯”æ¯”è¼ƒ", subtitle: "Compare & Contrast", theme: "purple", color: "purple-500", icon: "list-checks", hasTopics: true,
                topics: [
                    { id: "city", title: "City vs. Country", icon: "building-2", desc: "æ¯”è¼ƒéƒ½å¸‚ä¾¿åˆ©èˆ‡é„‰æ‘å¯§éœã€‚", type: "text" },
                    { id: "elearn", title: "Paper vs. Digital", icon: "book-open", desc: "ç´™æœ¬èˆ‡é›»å­æ›¸å­¸ç¿’å°æ¯”ã€‚", type: "text" },
                    { id: "movie", title: "Theater vs. Home", icon: "clapperboard", desc: "é›»å½±é™¢èˆ‡åœ¨å®¶çœ‹åŠ‡å·®åˆ¥ã€‚", type: "text" }
                ],
                steps: [
                    { id: "intro", label: "Intro ç°¡ä»‹", patterns: ["While A and B share...", "Comparing A and B reveals..."], words: ["comparison", "distinct"], tip: "å°è±¡ç°¡ä»‹ã€‚", examples: [{ en: "While city life and country life share some similarities, they differ greatly.", tw: "é›–ç„¶éƒ½å¸‚ç”Ÿæ´»å’Œé„‰æ‘ç”Ÿæ´»æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹è™•ï¼Œä½†å®ƒå€‘åœ¨è¨±å¤šæ–¹é¢å¤§ä¸ç›¸åŒã€‚" }, { en: "Comparing paper books and digital tools reveals significant differences.", tw: "æ¯”è¼ƒç´™æœ¬åœ–æ›¸å’Œæ•¸ä½å·¥å…·æ­ç¤ºäº†å­¸ç¿’æ•ˆç‡ä¸Šçš„é¡¯è‘—å·®ç•°ã€‚" }, { en: "Choosing between watching movies in a theater and at home is common.", tw: "åœ¨é›»å½±é™¢è§€å½±é‚„æ˜¯ç•™åœ¨å®¶ä¸­çœ‹é›»å½±æ˜¯ä¸€å€‹å¸¸è¦‹çš„é¸æ“‡å…©é›£ã€‚" }] },
                    { id: "sim", label: "Similarities å…±åŒ", patterns: ["Both A and B are...", "Similarly, both of them..."], words: ["likewise", "common"], tip: "å…©è€…å…±åŒé»ã€‚", examples: [{ en: "Both city and country living provide unique opportunities for growth.", tw: "éƒ½å¸‚å’Œé„‰æ‘ç”Ÿæ´»éƒ½ç‚ºå€‹äººæˆé•·æä¾›äº†ç¨ç‰¹çš„æ©Ÿæœƒã€‚" }, { en: "Similarly, both paper and digital tools aim to provide knowledge.", tw: "åŒæ¨£åœ°ï¼Œç´™æœ¬å’Œæ•¸ä½å·¥å…·éƒ½æ—¨åœ¨å‘è®€è€…æä¾›çŸ¥è­˜ã€‚" }, { en: "Likewise, both movie experiences offer high-quality entertainment.", tw: "åŒæ¨£åœ°ï¼Œé€™å…©ç¨®è§€å½±é«”é©—éƒ½ç‚ºè§€çœ¾æä¾›äº†é«˜å“è³ªçš„å¨›æ¨‚ã€‚" }] },
                    { id: "diff", label: "Differences ç›¸ç•°", patterns: ["On the contrary, ...", "Unlike A, B tends to..."], words: ["whereas", "contrast"], tip: "å…©è€…ç›¸ç•°é»ã€‚", examples: [{ en: "On the contrary, the city is bustling whereas the country is peaceful.", tw: "ç›¸ååœ°ï¼ŒåŸå¸‚ç¹å¿™å–§å›‚ï¼Œè€Œé„‰æ‘å‰‡å¯§éœå¹³å’Œã€‚" }, { en: "Unlike paper books, digital tools allow for instant searching and portability.", tw: "èˆ‡ç´™æœ¬åœ–æ›¸ä¸åŒï¼Œæ•¸ä½å·¥å…·å…è¨±å³æ™‚æœå°‹ä¸”æ˜“æ–¼æ”œå¸¶ã€‚" }, { en: "A theater offers immersion, while home streaming provides convenience.", tw: "é›»å½±é™¢æä¾›æ²ˆæµ¸æ„Ÿï¼Œè€Œå±…å®¶ä¸²æµå‰‡æä¾›ä¾¿åˆ©æ€§ã€‚" }] },
                    { id: "pref", label: "Preference åå¥½", patterns: ["As for me, I prefer A because...", "If I had to choose..."], words: ["choice", "favor"], tip: "å€‹äººåå¥½èˆ‡ç†ç”±ã€‚", examples: [{ en: "As for me, I prefer city life because of the access to modern facilities.", tw: "å°æˆ‘ä¾†èªªï¼Œæˆ‘æ›´å–œæ­¡åŸå¸‚ç”Ÿæ´»ï¼Œå› ç‚ºå¯ä»¥æ–¹ä¾¿ä½¿ç”¨ç¾ä»£è¨­æ–½ã€‚" }, { en: "If I had to choose, I would pick paper books for a traditional feel.", tw: "å¦‚æœå¿…é ˆé¸æ“‡ï¼Œæˆ‘æœƒé¸æ“‡ç´™æœ¬åœ–æ›¸ï¼Œå› ç‚ºæœ‰ä¸€ç¨®å‚³çµ±çš„é–±è®€æ„Ÿã€‚" }, { en: "Personally, I favor home streaming because I can watch anytime.", tw: "å°±å€‹äººè€Œè¨€ï¼Œæˆ‘åå¥½å±…å®¶ä¸²æµï¼Œå› ç‚ºæˆ‘å¯ä»¥éš¨æ™‚è§€çœ‹ã€‚" }] },
                    { id: "sum", label: "Final Thought ç¸½çµ", patterns: ["In short, both have pros and cons.", "Choosing between them..."], words: ["balanced", "perspective"], tip: "æœ€çµ‚å¿ƒå¾—ç¸½çµã€‚", examples: [{ en: "In short, both options have their own pros and cons for different people.", tw: "ç°¡è€Œè¨€ä¹‹ï¼Œé€™å…©å€‹é¸é …å°ä¸åŒçš„äººä¾†èªªå„æœ‰å„ªç¼ºé»ã€‚" }, { en: "Choosing between them depends on one's personal lifestyle.", tw: "åœ¨å…©è€…ä¹‹é–“åšé¸æ“‡å–æ±ºæ–¼å€‹äººçš„ç”Ÿæ´»æ–¹å¼å’Œå„ªå…ˆé †åºã€‚" }, { en: "Ultimately, both experiences contribute to a more diverse life.", tw: "æœ€çµ‚ï¼Œé€™å…©ç¨®é«”é©—éƒ½æœ‰åŠ©æ–¼éä¸Šæ›´å¤šå…ƒæœ‰è¶£çš„ç”Ÿæ´»ã€‚" }] }
                ]
            }
        };

        // --- å…¨åŸŸç‹€æ…‹ ---
        let state = {
            view: 'home',
            selectedMode: null,
            selectedTopic: null,
            currentStep: 0,
            answers: {},
            isAiLoading: false,
            aiFeedback: null
        };

        // --- æ ¸å¿ƒæ¸²æŸ“å‡½æ•¸ ---
        const app = document.getElementById('app');

        function render() {
            app.innerHTML = '';
            if (state.view === 'home') renderHome();
            else if (state.view === 'topic') renderTopicSelect();
            else if (state.view === 'editor') renderEditor();
            else if (state.view === 'finished') renderFinished();
            lucide.createIcons();
            updateBodyTheme();
        }

        function updateBodyTheme() {
            const template = WRITING_TEMPLATES[state.selectedMode];
            if (state.selectedMode) {
                const colorMap = {
                    cyan: "#ecfeff", pink: "#fdf2f8", indigo: "#eef2ff",
                    amber: "#fffbeb", orange: "#fff7ed", purple: "#faf5ff"
                };
                document.body.style.backgroundColor = colorMap[template.theme];
            } else {
                document.body.style.backgroundColor = "#ffffff";
            }
        }

        function renderHome() {
            app.innerHTML = `
                <header class="mb-16 text-center animate-pop">
                    <div class="inline-block p-4 bg-yellow-100 rounded-[2rem] mb-6 shadow-sm">
                        <i data-lucide="sparkles" class="text-yellow-500 w-10 h-10"></i>
                    </div>
                    <h1 class="text-5xl md:text-6xl font-black text-slate-800 tracking-tight mb-4">Writing Park</h1>
                    <p class="text-slate-400 font-black uppercase tracking-[0.4em] text-xs">AI è‹±æ–‡å¯«ä½œäº’å‹•æ¨‚åœ’</p>
                </header>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 animate-pop">
                    ${Object.entries(WRITING_TEMPLATES).map(([key, t]) => `
                        <button onclick="selectMode('${key}')" class="group p-10 bg-white rounded-[3.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.05)] border-4 border-transparent hover:border-${t.theme}-300 transition-all text-left transform btn-bounce">
                            <div class="w-16 h-16 bg-${t.theme}-100 text-${t.theme}-500 rounded-[1.5rem] flex items-center justify-center mb-8 group-hover:rotate-12 transition-transform">
                                <i data-lucide="${t.icon}" size="32"></i>
                            </div>
                            <h3 class="text-3xl font-black text-slate-800 mb-2">${t.title}</h3>
                            <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-4">${t.subtitle}</p>
                            <div class="flex items-center text-${t.theme}-500 font-black text-sm uppercase tracking-tighter">
                                Let's Play! <i data-lucide="chevron-right" size="16" class="ml-1"></i>
                            </div>
                        </button>
                    `).join('')}
                </div>
            `;
        }

        function renderTopicSelect() {
            const t = WRITING_TEMPLATES[state.selectedMode];
            app.innerHTML = `
                <div class="max-w-6xl mx-auto animate-pop">
                    <div class="text-center mb-16">
                        <span class="bg-white/50 px-6 py-2 rounded-full text-xs font-black text-${t.theme}-500 uppercase tracking-widest border border-${t.theme}-100">Step 1: Choose a path</span>
                        <h2 class="text-5xl font-black text-slate-800 mt-6 tracking-tight">é¸æ“‡ä¸€å€‹ç·´ç¿’ä¸»é¡Œ</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        ${t.topics.map(topic => `
                            <button onclick="selectTopic('${topic.id}')" class="bg-white p-10 rounded-[3rem] shadow-xl border-4 border-transparent hover:border-${t.theme}-300 transition-all text-left group flex flex-col h-full btn-bounce">
                                <div class="w-14 h-14 bg-${t.theme}-50 text-${t.theme}-400 rounded-2xl flex items-center justify-center mb-8 group-hover:scale-110 transition-transform">
                                    <i data-lucide="${topic.icon || 'star'}"></i>
                                </div>
                                <h3 class="text-xl font-black text-slate-800 mb-4 group-hover:text-${t.theme}-500 transition-colors">${topic.title}</h3>
                                <p class="text-slate-400 leading-relaxed flex-grow font-bold text-sm mb-8">${topic.desc}</p>
                                ${topic.pro ? `
                                    <div class="space-y-2 mt-auto">
                                        <div class="text-[10px] font-black bg-emerald-50 text-emerald-500 px-4 py-2 rounded-2xl border border-emerald-100 flex items-center gap-2 uppercase tracking-widest"><i data-lucide="smile" size="14"></i> PRO: ${topic.pro}</div>
                                        <div class="text-[10px] font-black bg-rose-50 text-rose-400 px-4 py-2 rounded-2xl border border-rose-100 flex items-center gap-2 uppercase tracking-widest"><i data-lucide="frown" size="14"></i> CON: ${topic.con}</div>
                                    </div>
                                ` : ''}
                            </button>
                        `).join('')}
                    </div>
                    <button onclick="goHome()" class="mt-16 mx-auto flex items-center gap-2 text-slate-300 font-black uppercase tracking-widest text-xs hover:text-slate-500 transition-colors group">
                        <i data-lucide="chevron-left" class="group-hover:-translate-x-1 transition-transform"></i> Back to the Park
                    </button>
                </div>
            `;
        }

        function renderEditor() {
            const t = WRITING_TEMPLATES[state.selectedMode];
            const step = t.steps[state.currentStep];
            app.innerHTML = `
                <div class="flex flex-col lg:flex-row gap-10 items-start animate-pop">
                    <div class="w-full lg:w-[35%] space-y-6 lg:sticky lg:top-8">
                        <!-- Task Card -->
                        <div class="bg-white rounded-[3rem] shadow-xl p-10 border-4 border-white">
                            <div class="flex items-center gap-4 mb-8">
                               <div class="p-3 bg-${t.theme}-100 text-${t.theme}-500 rounded-[1.2rem] shadow-inner">
                                  <i data-lucide="${t.icon}"></i>
                               </div>
                               <h3 class="font-black text-slate-800 text-sm uppercase tracking-widest">ä»»å‹™åœ°åœ–</h3>
                            </div>
                            <h4 class="text-2xl font-black text-slate-700 mb-6 leading-tight">${t.topics.find(x => x.id === state.selectedTopic).title}</h4>
                            ${renderContext(t)}
                        </div>

                        <!-- Phrase Bank -->
                        <div class="bg-slate-900 rounded-[3rem] p-10 text-white shadow-2xl relative overflow-hidden">
                           <div class="absolute top-0 right-0 w-32 h-32 bg-${t.theme}-500/20 rounded-full -mr-16 -mt-16"></div>
                           <h3 class="text-xs font-black uppercase tracking-[0.3em] text-${t.theme}-400 mb-8 flex items-center gap-2"><i data-lucide="zap" size="18"></i> é­”æ³•å¥å‹</h3>
                           <div class="space-y-8">
                             <div>
                               <span class="text-[10px] font-black text-white/30 uppercase tracking-widest block mb-4">å’’èªå¥å‹ (Patterns)</span>
                               <div class="flex flex-wrap gap-2">
                                  ${step.patterns.map(p => `
                                    <button onclick="insertText('${p.replace('...', ' ')}')" class="text-[11px] bg-white/10 hover:bg-white/20 px-4 py-2.5 rounded-2xl border border-white/5 transition-all font-mono italic text-blue-100 btn-bounce">${p}</button>
                                  `).join('')}
                               </div>
                             </div>
                             <div class="pt-6 border-t border-white/10">
                               <span class="text-[10px] font-black text-white/30 uppercase tracking-widest block mb-4">é­”æ³•å–®å­— (Words)</span>
                               <div class="flex flex-wrap gap-2">
                                  ${step.words.map(w => `<span class="text-[10px] font-black text-${t.theme}-300 uppercase bg-${t.theme}-50/20 px-4 py-2 rounded-xl border border-white/5">#${w}</span>`).join('')}
                               </div>
                             </div>
                           </div>
                        </div>
                    </div>

                    <div class="flex-1 bg-white rounded-[4rem] shadow-2xl overflow-hidden border-8 border-white flex flex-col">
                        <!-- Step Header -->
                        <div class="bg-${t.theme}-400 p-10 text-white flex justify-between items-center relative">
                            <button onclick="handleBack()" class="p-4 hover:bg-black/10 rounded-3xl transition-colors"><i data-lucide="chevron-left" size="28"></i></button>
                            <div class="text-center">
                                <span class="text-[10px] font-black opacity-60 block uppercase tracking-[0.4em] mb-2">${t.subtitle}</span>
                                <span class="font-black text-3xl tracking-tight">${step.label}</span>
                            </div>
                            <div class="bg-white/30 px-6 py-2 rounded-full text-sm font-black shadow-inner">#${state.currentStep + 1}</div>
                        </div>

                        <div class="p-10 md:p-14">
                            <!-- Model Examples -->
                            <div class="mb-12">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="w-2 h-6 bg-${t.theme}-400 rounded-full"></div>
                                    <span class="font-black text-slate-800 text-sm uppercase tracking-widest">çœ‹çœ‹é«˜åˆ†ç¯„ä¾‹ (å¸¶ç¿»è­¯)ï¼š</span>
                                </div>
                                <div class="grid grid-cols-1 gap-4">
                                    ${(step.examples || []).map((ex, i) => `
                                        <button onclick="insertText('${ex.en.replace(/'/g, "\\'")}')" class="text-left p-6 rounded-[2rem] bg-slate-50 border-4 border-transparent hover:border-${t.theme}-200 hover:bg-white transition-all group btn-bounce">
                                            <p class="text-slate-700 font-serif italic text-lg leading-relaxed mb-1">${ex.en}</p>
                                            <p class="text-slate-400 text-sm font-bold">${ex.tw}</p>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>

                            <textarea id="editor-field" oninput="handleTyping(event)" class="w-full h-56 p-10 bg-slate-50 border-4 border-slate-50 rounded-[3rem] focus:bg-white focus:border-${t.theme}-300 focus:outline-none transition-all text-2xl font-serif leading-relaxed shadow-inner mb-8" placeholder="åƒè€ƒç¯„ä¾‹å¯«ä¸‹ä½ çš„å¥å­...">${state.answers[step.id] || ''}</textarea>
                            
                            <div class="flex justify-between items-center">
                               <p class="text-xs text-slate-300 font-bold italic tracking-wide">ğŸ’¡ é»æ“Šç¯„ä¾‹ç›´æ¥å¼•ç”¨ï¼ˆåƒ…å¼•ç”¨è‹±æ–‡ï¼‰</p>
                               <button onclick="getAIFeedback()" id="ai-btn" class="flex items-center gap-3 px-10 py-5 rounded-[2rem] font-black text-sm bg-gradient-to-r from-pink-400 to-purple-500 text-white shadow-xl btn-bounce">
                                  <i data-lucide="zap"></i> AI é­”æ³•ä¿®æ­£
                               </button>
                            </div>

                            <div id="ai-feedback-container"></div>

                            <div class="flex justify-between items-center mt-16 pt-12 border-t-4 border-slate-50">
                                <button onclick="prevStep()" class="px-10 text-slate-300 font-black uppercase tracking-widest text-xs hover:text-slate-500 transition-colors" ${state.currentStep === 0 ? 'disabled' : ''}>Prev</button>
                                <button onclick="nextStep()" class="bg-${t.theme}-400 text-white px-16 py-6 rounded-[2.5rem] font-black text-xl shadow-2xl btn-bounce">
                                    ${state.currentStep === t.steps.length - 1 ? "å®Œæˆä»»å‹™" : "ä¸‹ä¸€æ­¥é©Ÿ"} <i data-lucide="arrow-right" class="inline ml-1"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Live Progress -->
                        <div class="bg-slate-50 p-12 text-slate-400 shadow-inner">
                            <div class="flex items-center gap-3 mb-6 opacity-50">
                                <div class="w-2 h-2 rounded-full bg-${t.theme}-400 animate-pulse"></div>
                                <span class="text-[10px] font-black uppercase tracking-[0.4em]">æˆ‘çš„æ®µè½åŠæˆå“</span>
                            </div>
                            <p class="text-2xl font-serif italic leading-loose">${Object.values(state.answers).filter(x => x).join(' ') || 'é‚„æ²’æœ‰å¯«ä¸‹å…§å®¹å–”...'}</p>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('editor-field').focus();
        }

        function renderFinished() {
            const t = WRITING_TEMPLATES[state.selectedMode];
            const fullText = t.steps.map(s => state.answers[s.id] || '').filter(x => x).join(' ');
            app.innerHTML = `
                <div class="max-w-4xl mx-auto bg-white rounded-[4rem] shadow-2xl p-14 animate-pop text-center relative overflow-hidden border-8 border-white flex flex-col items-center">
                    <div class="absolute top-0 right-0 w-80 h-80 bg-${t.theme}-50 rounded-full -mr-40 -mt-40 opacity-50"></div>
                    <div class="mb-12 relative z-10 w-full">
                        <div class="w-24 h-24 bg-yellow-100 text-yellow-500 rounded-[2.5rem] flex items-center justify-center mx-auto mb-10 shadow-inner">
                            <i data-lucide="trophy" size="48"></i>
                        </div>
                        <h2 class="text-6xl font-black text-slate-800 tracking-tighter uppercase mb-4">Amazing!</h2>
                        <p class="text-slate-400 font-black uppercase tracking-[0.4em] text-xs italic">ä½ å®Œæˆäº†ä¸€æ®µé«˜å“è³ªçš„è‹±æ–‡å‰µä½œï¼š</p>
                    </div>
                    <div class="p-12 rounded-[3rem] border-4 border-${t.theme}-100 bg-${t.theme}-50 mb-12 text-3xl text-slate-700 font-serif italic leading-[2.4] serif text-left shadow-inner relative z-10 w-full">
                        ${fullText}
                    </div>
                    <div class="flex flex-col md:flex-row gap-6 relative z-10 w-full">
                        <button onclick="copyResult('${fullText.replace(/'/g, "\\'")}')" class="flex-[2] bg-${t.theme}-400 text-white py-8 rounded-[2.5rem] font-black text-2xl flex items-center justify-center gap-4 shadow-2xl btn-bounce">
                            <i data-lucide="copy" size="28"></i> è¤‡è£½ä½œå“
                        </button>
                        <button onclick="restart()" class="flex-1 bg-slate-100 text-slate-400 py-8 rounded-[2.5rem] font-black text-2xl hover:bg-slate-200 transition-colors">å›é¦–é </button>
                    </div>
                </div>
            `;
        }

        function renderContext(t) {
            const topic = t.topics.find(x => x.id === state.selectedTopic);
            if (topic.type === 'chart') {
                return `
                    <div class="space-y-6">
                        <p class="text-xs text-slate-400 font-bold tracking-wide mb-2 uppercase">${topic.desc}</p>
                        ${topic.items.map(item => `
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs font-black"><span>${item.label}</span><span class="text-${t.theme}-500">${item.value}%</span></div>
                                <div class="w-full h-4 bg-slate-100 rounded-full overflow-hidden shadow-inner border border-white">
                                    <div class="h-full ${item.color} rounded-full transition-all duration-1000 shadow-sm" style="width: ${item.value}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            return `<p class="text-lg italic text-slate-500 bg-slate-50 p-8 rounded-[2rem] font-bold leading-relaxed border-4 border-white shadow-inner">"${topic.desc}"</p>`;
        }

        // --- äº’å‹•é‚è¼¯å‡½æ•¸ ---
        function selectMode(key) {
            state.selectedMode = key;
            state.answers = {};
            state.currentStep = 0;
            state.view = 'topic';
            render();
        }

        function selectTopic(tid) {
            state.selectedTopic = tid;
            state.view = 'editor';
            render();
        }

        function goHome() {
            state.selectedMode = null;
            state.selectedTopic = null;
            state.view = 'home';
            render();
        }

        function handleBack() {
            state.selectedTopic = null;
            state.view = 'topic';
            render();
        }

        function handleTyping(e) {
            const sid = WRITING_TEMPLATES[state.selectedMode].steps[state.currentStep].id;
            state.answers[sid] = e.target.value;
        }

        function insertText(text) {
            const el = document.getElementById('editor-field');
            const sid = WRITING_TEMPLATES[state.selectedMode].steps[state.currentStep].id;
            state.answers[sid] = text;
            el.value = text;
            el.focus();
        }

        function nextStep() {
            if (state.currentStep < WRITING_TEMPLATES[state.selectedMode].steps.length - 1) {
                state.currentStep++;
                state.aiFeedback = null;
                render();
            } else {
                state.view = 'finished';
                render();
            }
        }

        function prevStep() {
            if (state.currentStep > 0) {
                state.currentStep--;
                state.aiFeedback = null;
                render();
            }
        }

        function copyResult(text) {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            const btn = event.currentTarget;
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="check-circle"></i> æ®µè½å·²å¸¶èµ°ï¼';
            lucide.createIcons();
            setTimeout(() => { btn.innerHTML = originalHTML; lucide.createIcons(); }, 2000);
        }

        function restart() {
            state = { view: 'home', selectedMode: null, selectedTopic: null, currentStep: 0, answers: {}, isAiLoading: false, aiFeedback: null };
            render();
        }

        async function getAIFeedback() {
            const t = WRITING_TEMPLATES[state.selectedMode];
            const topic = t.topics.find(x => x.id === state.selectedTopic);
            const step = t.steps[state.currentStep];
            const text = state.answers[step.id];
            if (!text || text.trim().length < 5) return;

            const btn = document.getElementById('ai-btn');
            const container = document.getElementById('ai-feedback-container');
            
            btn.disabled = true;
            btn.innerHTML = '<i data-lucide="loader-2" class="animate-spin"></i> æ­£åœ¨å”¸å’’...';
            lucide.createIcons();
            
            const apiKey = ""; 
            const prompt = `ä½ æ˜¯ä¸€ä½æ´»æ½‘çš„è‹±æ–‡è€å¸«ã€‚åˆ†æå­¸ç”Ÿçš„ç·´ç¿’ã€‚
                æ–‡é«”é¡å‹: ${t.title}, ä¸»é¡Œä»»å‹™: ${topic.title}, å¯«ä½œæ­¥é©Ÿ: ${step.label}ã€‚
                å­¸ç”Ÿå¥å­: "${text}"ã€‚
                å›æ‡‰ JSON: { "isCorrect": bool, "corrected": "ä¿®æ­£å¥", "explanation": "ç”¨æ´»æ½‘å£å»è§£é‡‹ç‚ºä»€éº¼", "better": "é“åœ°çš„é«˜ç´šå¯«æ³•", "tips": ["å–®å­—1", "å–®å­—2"] }`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await res.json();
                const result = JSON.parse(data.candidates[0].content.parts[0].text);
                renderAiFeedback(result);
            } catch (e) {
                container.innerHTML = `<div class="mt-6 p-6 bg-yellow-50 text-yellow-600 text-sm font-black rounded-[2rem] border-4 border-white shadow-inner">å“å‘€ï¼é­”æ³•ç“¶æš«æ™‚æ²’æ°´äº†ï¼Œè«‹å…ˆæª¢æŸ¥æ–‡æ³•ç¹¼çºŒå‰é€²å§ï¼</div>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i data-lucide="zap"></i> AI é­”æ³•ä¿®æ­£';
                lucide.createIcons();
            }
        }

        function renderAiFeedback(fb) {
            const container = document.getElementById('ai-feedback-container');
            container.innerHTML = `
                <div class="mt-10 p-10 bg-indigo-50 border-8 border-white rounded-[3.5rem] animate-pop shadow-xl relative overflow-hidden">
                    <div class="flex items-center gap-3 mb-8 font-black text-indigo-500 text-xs uppercase tracking-[0.3em] relative z-10"><i data-lucide="sparkles" size="20"></i> AI é­”æ³•é»è©•</div>
                    ${!fb.isCorrect ? `<div class="mb-8 p-6 bg-white text-rose-400 rounded-[2rem] border-4 border-rose-50 text-lg italic font-serif shadow-sm relative z-10 animate-pop">é€™æ¨£å¯«æ›´æ£’ï¼š${fb.corrected}</div>` : ''}
                    <p class="text-base text-slate-500 mb-10 font-bold leading-relaxed relative z-10">${fb.explanation}</p>
                    <div class="p-10 bg-white rounded-[2.5rem] border-4 border-indigo-100 relative shadow-inner">
                        <button onclick="insertText('${fb.better.replace(/'/g, "\\'")}')" class="absolute -top-6 -right-6 bg-indigo-500 text-white px-8 py-4 rounded-[2rem] text-sm font-black shadow-2xl hover:scale-105 active:scale-95 transition-all">å¥—ç”¨å’’èª âœ¨</button>
                        <span class="text-[10px] font-black text-indigo-200 block mb-4 uppercase tracking-[0.2em]">é“åœ°é­”æ³•è¡¨é” (Model)</span>
                        <p class="text-2xl font-serif font-black italic text-slate-800 leading-relaxed tracking-tight">"${fb.better}"</p>
                    </div>
                </div>
            `;
            lucide.createIcons();
            container.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // é é¢åˆå§‹åŒ–
        render();
    </script>
</body>
</html>
